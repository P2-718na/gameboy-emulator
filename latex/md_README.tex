 

This is an implementation of the original Game Boy (DMG0) hardware written in C++. It features a full CPU implementation and an approximate PPU implementation (no audio, yet). This project can be run standalone (using the provided SFML-\/based graphical interface) or it can be incorporated in another project as a library. Here are some screenshots!

$\vert$  $\vert$  $\vert$  $\vert$  $\vert$ $\vert$\+:-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/---\+:$\vert$\+:-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/---\+:$\vert$\+:-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/---\+:$\vert$\+:-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/---\+:$\vert$\hypertarget{md_README_autotoc_md3}{}\doxysection{Features and Overview}\label{md_README_autotoc_md3}
The goal of this project was not to achieve perfect accuracy, but rather to obtain a functioning implementation that can be easily improved upon. I have approximated some aspects of the hardware and in some places I have valued code clarity above raw performance. I expect most (supported) ROMs to run fine in this emulator, possibly with some graphical glitches. Here is a brief list of all the supported features. To understand the meaning of technical terms, please refer to \mbox{\hyperlink{md_HARDWARE}{HARDWARE.md}}.

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Feature   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Status   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Comment    }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Feature   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Status   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Comment    }\\\cline{1-3}
\endhead
CPU Instructions   &\PBS\centering 🟢   &All CPU instructions have been implemented and they pass Blargg\textquotesingle{}s {\ttfamily cpu\+\_\+instrs} tests (see Testing).    \\\cline{1-3}
Interrupts and timers   &\PBS\centering 🟢   &CPU interrupts and timer have been implemented. Interrupts do pass Blargg\textquotesingle{}s tests; tcu do not (see Testing).    \\\cline{1-3}
Savegames   &\PBS\centering 🟢   &Although very basic, the implementation of savegames (battery-\/backed cartridges) works correctly. Games are saved whenever the emulator window is closed.    \\\cline{1-3}
Performance   &\PBS\centering 🟢   &The DMG hardware is very simple and the emulator runs fast. Multithreading could be implemented easily to speed up performance even more. Profiler shows that the performance impact is uniformly spread out throughout the different Game Boy components.    \\\cline{1-3}
Graphics   &\PBS\centering 🟠   &PPU Timings are machine-\/cycle accurate, but there is no FIFO implementation. Each scanline gets drawn all at once. Expect some minor glitches.    \\\cline{1-3}
Timing accuracy   &\PBS\centering 🟠   &The time step of the emulator is one machine-\/cycle. CPU instructions are atomic but execution is still delayed by the correct amount of cycles.    \\\cline{1-3}
ROM Loading   &\PBS\centering 🟠   &Only {\ttfamily MBC0}, {\ttfamily MBC1} and {\ttfamily MBC3} (without RTC hardware) cartridges are implemented. The code is set up to allow for easy addition of new cartridge types. Multicart ROMs are not supported!    \\\cline{1-3}
Serial   &\PBS\centering 🟠   &Only basic serial reading was implemented for debugging purposes.    \\\cline{1-3}
Audio   &\PBS\centering 🔴   &No APU implementation yet.    \\\cline{1-3}
Hardware bugs and edge cases   &\PBS\centering 🔴   &Most of the original hardware\textquotesingle{}s edge cases and bugs have not been implemented. Regardless, official ROMs should not depend on them in the first place.    \\\cline{1-3}
Savestates   &\PBS\centering 🔴   &The way the code is set up makes serializing the state a bit cumbersome. Regardless, I did not intend for savestates to be available in the first place.   \\\cline{1-3}
\end{longtabu}
\hypertarget{md_README_autotoc_md4}{}\doxysection{Building}\label{md_README_autotoc_md4}
\hypertarget{md_README_autotoc_md5}{}\doxysubsection{Dependencies}\label{md_README_autotoc_md5}
The emulator library does not use any external dependencies, apart from the standard library. To build the standalone program, however, you will need\+:
\begin{DoxyItemize}
\item \href{https://github.com/bfgroup/Lyra}{\texttt{ Lyra}} (already bundled)
\item \href{https://github.com/onqtam/doctest}{\texttt{ Doctest}} (already bundled)
\item \href{http://www.sfml-dev.org/}{\texttt{ SFML 2.\+6}} (has to be installed manually)
\end{DoxyItemize}

The recommended way to build this code is by using \href{https://cmake.org/}{\texttt{ CMake}}. When testing and when writing new code, one should compile using the {\ttfamily Debug} configuration, as it enables additional checks ({\ttfamily -\/fsanitize=\char`\"{}address\char`\"{}}, code asserts, ...), disables optimization and writes debugging symbols to the binary file. For the best performance, build using the {\ttfamily Release} configuration. Bear in mind that code asserts are {\itshape disabled} in the latter, and they should not be relied upon to handle control flow.\hypertarget{md_README_autotoc_md6}{}\doxysubsection{Building the standalone emulator}\label{md_README_autotoc_md6}

\begin{DoxyCode}{0}
\DoxyCodeLine{\#\ Clone\ the\ repo}
\DoxyCodeLine{git\ clone\ git@github.com:P2-\/718na/gameboy-\/emulator.git}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ Create\ and\ cd\ to\ build\ directory}
\DoxyCodeLine{take\ gameboy-\/emulator/build}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ Prepare\ build\ files.\ Use\ "{}Debug"{}\ instead\ of\ "{}Release"{}\ to\ build\ in\ debug\ mode.}
\DoxyCodeLine{cmake\ ..\ -\/DCMAKE\_BUILD\_TYPE=Release}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ Build\ everything}
\DoxyCodeLine{make}

\end{DoxyCode}


This will configure all the needed files. Two executables will be generated (see Running for additional information on what they do).


\begin{DoxyCode}{0}
\DoxyCodeLine{./emulator\ \ \ \#\ Run\ standalone\ emulator}
\DoxyCodeLine{}
\DoxyCodeLine{./test\ \ \ \ \ \ \#\ Run\ tests}

\end{DoxyCode}
\hypertarget{md_README_autotoc_md7}{}\doxysubsection{Building the emulator library}\label{md_README_autotoc_md7}
All the emulator code is contained in the {\ttfamily Gameboy} class and its dependencies. To use this in your own CMake project, make sure to 1) add it as a source directory, 2) link it to your target and 3) add all the necessary include folders. 
\begin{DoxyCode}{0}
\DoxyCodeLine{\#\ ...}
\DoxyCodeLine{}
\DoxyCodeLine{ADD\_SUBDIRECTORY(src)}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ ...}
\DoxyCodeLine{}
\DoxyCodeLine{TARGET\_LINK\_LIBRARIES(your\_target\ Gameboy)}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ ...}
\DoxyCodeLine{}
\DoxyCodeLine{INCLUDE\_DIRECTORIES(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ "{}\$\{PROJECT\_SOURCE\_DIR\}/src"{}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ "{}\$\{PROJECT\_SOURCE\_DIR\}/src/Frontend"{}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ "{}\$\{PROJECT\_SOURCE\_DIR\}/src/Gameboy"{}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ "{}\$\{PROJECT\_SOURCE\_DIR\}/src/CPU"{}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ "{}\$\{PROJECT\_SOURCE\_DIR\}/src/PPU"{}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ "{}\$\{PROJECT\_SOURCE\_DIR\}/src/TimerController"{}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ "{}\$\{PROJECT\_SOURCE\_DIR\}/src/AddressBus"{}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ "{}\$\{PROJECT\_SOURCE\_DIR\}/src/Cartridge"{}}
\DoxyCodeLine{)}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ ...}

\end{DoxyCode}
 The current organization of the include directories is a bit cumbersome, but I am planning on improving it. If you want to run Blargg\textquotesingle{}s tests, make sure to also copy the test ROMs to the binary folder.

To learn how to use the {\ttfamily Gameboy} library, please refer to the documentation.\hypertarget{md_README_autotoc_md8}{}\doxysubsection{Building on different systems}\label{md_README_autotoc_md8}
The code was written on mac\+OS Monterey (Apple clang 14.\+0.\+0) and it builds just fine on Linux. Building on Windows and other systems should be just a matter of installing SFML and running CMake.\hypertarget{md_README_autotoc_md9}{}\doxysection{Running}\label{md_README_autotoc_md9}
\hypertarget{md_README_autotoc_md10}{}\doxysubsection{Standalone emulator}\label{md_README_autotoc_md10}
The standalone emulator should be called with exactly one parameter\+: the path to the ROM file to be loaded 
\begin{DoxyCode}{0}
\DoxyCodeLine{./emulator\ rom-\/name.gb}

\end{DoxyCode}
 if the ROM file is of a battery-\/backed cartridge, a save file will be generated (if not already present) in the same folder as the ROM, named {\ttfamily rom-\/name.\+gb.\+sav}. The save file will then be loaded automatically every time the game is run. Please bear in mind that the ROM and the save file should be kept in the same folder and should respect the naming convention that was just described here, in order to be loaded correctly.

Running the emulator will open a window. Then, the user can interact with the emulator using the following key bindings.

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Key   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Game Boy button    }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Key   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Game Boy button    }\\\cline{1-2}
\endhead
Space   &\PBS\centering A    \\\cline{1-2}
Shift   &\PBS\centering B    \\\cline{1-2}
Enter   &\PBS\centering Start    \\\cline{1-2}
Escape   &\PBS\centering Select    \\\cline{1-2}
W/\+A/\+S/D   &\PBS\centering {$\uparrow$}/{$\leftarrow$}/{$\downarrow$}/{$\rightarrow$}   \\\cline{1-2}
\end{longtabu}
\hypertarget{md_README_autotoc_md11}{}\doxysubsection{Tests}\label{md_README_autotoc_md11}
Here I am using the \href{https://github.com/doctest/doctest}{\texttt{ Doctest}} library to run tests. Currently, the tests consist of a subset of \href{https://gbdev.gg8.se/wiki/articles/Test_ROMs}{\texttt{ Blargg\textquotesingle{}s test ROMs}} and a series of unit tests written by me. Not all methods are tested, but asserts are added throughout the entire code base to check for possible mistakes in the development phase.

To launch the tests, run 
\begin{DoxyCode}{0}
\DoxyCodeLine{./test}

\end{DoxyCode}
 from the build directory. This will run both unit tests and the test ROMs, in order. Please bear in mind that not all test ROMs will complete successfully\+: this is due to the emulator approximations, and it is expected. Only the failure of critical test ROMs (such as {\ttfamily cpu\+\_\+instrs}) will report the tests as unsuccessful.\hypertarget{md_README_autotoc_md12}{}\doxysection{Code structure}\label{md_README_autotoc_md12}
The code follows the basic principles of Object-\/\+Oriented Programming. Each physical Game Boy component is implemented in its own separate class ({\ttfamily CPU}, {\ttfamily PPU}, {\ttfamily Timer\+Controller}). Each component has a {\ttfamily machine\+Clock()} method (to be called each clock cycle) and has access to the shared {\ttfamily Address\+Bus} and to the main {\ttfamily Gameboy} instance. The {\ttfamily Cartridge} class is an interface used to implement different cartridge types. Finally, the {\ttfamily Frontend} class handles the interactions with the user and the environment. The {\ttfamily Gameboy} class is to be intended as the public interface of the library, and additional documentation is available for it (see Documentation). The following table contains a summary of what each class does.

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Class   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Description    }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Class   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Description    }\\\cline{1-2}
\endhead
{\ttfamily Frontend}   &Handles loading of ROMs and save files, graphical output, user input, and clocks the emulator.    \\\cline{1-2}
{\ttfamily Gameboy}   &Container for all the Game Boy components. Handles interrupt requests and exposes methods that allow {\ttfamily Frontend} to read and change the status of the system (display, inputs...).    \\\cline{1-2}
{\ttfamily Address\+Bus}   &Handles reads and writes from RAM, ROM and registers. All components of the Game Boy should have access to this.    \\\cline{1-2}
{\ttfamily Cartridge}   &Virtual base class that defines the interface that each cartridge type should have. Implementations of new cartridge hardware should be added as a derived class of this one.    \\\cline{1-2}
{\ttfamily CPU}   &Represents the physical Game Boy processor. Reads and executes instructions from the Address Bus.    \\\cline{1-2}
{\ttfamily PPU}   &Represent the physical Game Boy graphics unit. Periodically updates the screen buffer and requests the necessary interrupts.    \\\cline{1-2}
{\ttfamily Timer\+Controller}   &Represent the physical Game Boy timer hardware. Consists of a series of counters that increment at each clock cycle and eventually request interrupts.   \\\cline{1-2}
\end{longtabu}
\hypertarget{md_README_autotoc_md13}{}\doxysection{Additional notes}\label{md_README_autotoc_md13}
\hypertarget{md_README_autotoc_md14}{}\doxysubsection{Contributing}\label{md_README_autotoc_md14}
If you want to open a pull request, please see \mbox{\hyperlink{md_CONTRIBUTING}{CONTRIBUTING.md}}\hypertarget{md_README_autotoc_md15}{}\doxysubsection{Hardware primer}\label{md_README_autotoc_md15}
For a quick introduction to the DMG0\textquotesingle{}s hardware, and the list of all the references I used for this project, see \mbox{\hyperlink{md_HARDWARE}{HARDWARE.md}}\hypertarget{md_README_autotoc_md16}{}\doxysubsection{Documentation}\label{md_README_autotoc_md16}
Documentation is automatically generated for the {\ttfamily Gameboy} library using Doxygen. The documentation for the current version on {\ttfamily master} is available \href{https://p2-718na.github.io/gameboy-emulator/html/classgb_1_1Gameboy.html}{\texttt{ here}}.\hypertarget{md_README_autotoc_md17}{}\doxysubsection{On code clarity}\label{md_README_autotoc_md17}
I used several tools to make sure that my code is correct, clean and consistent. Namely\+:


\begin{DoxyEnumerate}
\item Clang-\/\+Format to check code formatting (\href{.clang-format}{\texttt{ .clang-\/format}}).
\item Clang-\/\+Tidy to check for common bad-\/practice warnings (\href{https://confluence.jetbrains.com/display/CLION/Clang-Tidy+in+CLion\%3A+default+configuration?_ga=2.184137826.59717557.1623227743-1021145942.1623227743}{\texttt{ CLion default configuration}}).
\end{DoxyEnumerate}

I also run the code through {\itshape Valgrind Memcheck} so to make sure that there are no memory-\/related errors in my code.

\DoxyHorRuler{0}
 
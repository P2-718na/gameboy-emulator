<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Game Boy Emulator: Testing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Game Boy Emulator<span id="projectnumber">&#160;1</span>
   </div>
   <div id="projectbrief">A Game Boy emulator (library) written in c++</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_TESTING.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Testing </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This document outlines the three main testing methods used to ensure reliability of all the components in the Game Boy emulator project. The test are run using the <a href="https://github.com/doctest/doctest">Doctest</a> framework (bundled in the source files). The aim of these tests is to cover as much of the code base as possible, all while remaining within the limits of the Doctest framework.</p>
<h2><a class="anchor" id="autotoc_md20"></a>
Building and running tests</h2>
<p>Tests are built alongside the main executable when calling <code>make</code>, or you can build them individually: </p><div class="fragment"><div class="line">take build</div>
<div class="line">cmake ..</div>
<div class="line">make test</div>
</div><!-- fragment --><p>If you are building without CMake, make sure to build tests in debug mode! This allows the <code>assert</code> statements to function properly. Also, make sure to copy the needed test ROMs to the correct path inside the build folder.</p>
<p>To run the tests, run </p><div class="fragment"><div class="line">./test -s</div>
</div><!-- fragment --><p> from the build directory. The <code>-s</code> option is used to display successful tests as well. This will run both unit tests and the test ROMs, in order. An exit value of <code>0</code> indicates that all the tests are successful.</p>
<h1><a class="anchor" id="autotoc_md21"></a>
1. Unit testing</h1>
<p>The emulator uses the <a href="https://github.com/doctest/doctest">Doctest</a> framework for unit testing. These tests are located in the <code>tests/</code> directory and cover individual components of the emulator:</p>
<ul>
<li><code>cpu.test.cpp</code>: Tests basic CPU operation.</li>
<li><code>address-bus.test.cpp</code>: Tests basic memory access and addressing.</li>
<li><code>ppu.test.cpp</code>: Tests PPU timing and initialization.</li>
<li><code>timer-controller.test.cpp</code>: Extensively tests timer functionality.</li>
<li><code>cartridge.test.cpp</code>: Tests ROM loading and parsing.</li>
<li><code>gameboy.test.cpp</code>: Tests the main emulator class functionality and interface.</li>
<li><code>frontend.test.cpp</code>: Tests that the code throws under certain conditions.</li>
</ul>
<p>The <code>Frontend</code> class has the fewer tests. This is because it interacts strongly with the operating system and the user and not every feature can be tested easily. To ensure it works properly, I have resorted to "manual" testing.</p>
<h1><a class="anchor" id="autotoc_md22"></a>
2. Test ROMs</h1>
<p>Test ROMs are special Game Boy ROMs designed specifically to test the accuracy of emulators. Unlike regular games, these ROMs contain test programs that verify specific hardware behaviors and features. They are essential tools in emulator development because they provide a standardized way to test hardware accuracy. Most test ROMs are developed by the community, and they can be more or less <em>strict</em> in checking correct behavior. They are a very useful tool to check aspects of the hardware in which multiple components are involved simultaneously (for example, the PPU).</p>
<p>One small downside of using test ROMs is that they require some degree of CPU functionality in order to work. If the CPU is not working correctly to begin with, test ROMs could fail to report a failed test, or worse, report a test as successful even if it was not. This means that some degree of manual checking has to be done, at least in the first phases of development.</p>
<h2><a class="anchor" id="autotoc_md23"></a>
Blargg's tests</h2>
<p>Blargg's tests are the most famous test ROMs available. The full test suite was written in assembly, and it thoroughly checks most aspects of the Game Boy hardware. The tests can be run separately, and they report their results both using the Game Boy screen and its serial port. This has the advantage of being able to run these tests even before a working PPU implementation is available.</p>
<p>When running tests, the following test ROMs from Blargg's suite are automatically run:</p><ul>
<li><code>cpu_instrs</code>: Tests CPU instruction accuracy and timing</li>
<li><code>instr_timing</code>: Verifies instruction cycle counts</li>
<li><code>interrupt_time</code>: Tests interrupt timing and behavior</li>
<li><code>halt_bug</code>: Tests the CPU's HALT instruction bug behavior</li>
</ul>
<p>In the current version of the emulator, only <code>cpu_instrs</code> will actually pass. This is expected behavior, and there are several reasons for this:</p>
<ol type="1">
<li><b>Hardware Approximations</b>: The emulator makes some approximations for performance and simplicity. For example:<ul>
<li>The PPU doesn't implement the exact pixel FIFO behavior</li>
<li>Some hardware bugs and edge cases aren't replicated</li>
<li>Timing is machine-cycle accurate but not pixel-cycle accurate</li>
</ul>
</li>
<li><b>Unimplemented Features</b>: Some test ROMs check features that aren't yet implemented:<ul>
<li>Audio processing (APU) tests will fail as audio isn't implemented</li>
<li>RTC (Real-Time Clock) tests will fail for MBC3 cartridges</li>
<li>Some serial communication tests may fail</li>
</ul>
</li>
<li><b>Performance vs Accuracy Trade-offs</b>: Some test ROMs check for exact hardware behavior that would be too expensive to implement perfectly. For example:<ul>
<li>Exact memory bus timing</li>
<li>Precise LCD timing and pixel-by-pixel rendering</li>
<li>Hardware-level bugs that affect very few games</li>
</ul>
</li>
</ol>
<p>The goal of this emulator is to run most commercial games correctly, not to pass every test ROM. <code>cpu_instrs</code> checks that <em>all</em> CPU instructions work correctly, and passing this test is a satisfactory result in itself. I have included the other ROMs in the tests to make sure that <em>they fail</em> (as I know they should). This should help avoid some possible false positives in testing.</p>
<p>I did not include any PPU-testing ROM because they would most likely fail. The PPU is an approximation and most ROMs available only check for <em>exact</em> results. Thus, there is no point in adding them.</p>
<h1><a class="anchor" id="autotoc_md24"></a>
3. Runtime Assertions</h1>
<p>The emulator uses C++ assertions (<code>assert()</code>) throughout the codebase to catch potential issues during development and debugging. These assertions check for:</p>
<ul>
<li>Invalid memory accesses</li>
<li>Incorrect register values</li>
<li>Invalid state transitions</li>
<li>Hardware timing violations</li>
</ul>
<p>Assertions are enabled in debug builds and are automatically disabled in release builds for performance. Disabling assertions should not have any effect on the final results, as they should not be used as a means of control flow, regardless.</p>
<h1><a class="anchor" id="autotoc_md25"></a>
Test Coverage</h1>
<p>The combination of these three testing methods provides comprehensive coverage: This multi-layered approach helps maintain the emulator's accuracy and reliability while balancing performance and development effort. Code Coverage results are reported as a badge in the main README file of this repository. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>

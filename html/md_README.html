<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Game Boy Emulator: gameboy-emulator</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Game Boy Emulator<span id="projectnumber">&#160;1</span>
   </div>
   <div id="projectbrief">A Game Boy emulator (library) written in c++</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_README.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">gameboy-emulator </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><img src="https://img.shields.io/badge/code%20coverage-70%25-green" alt="" class="inline"/> <img src="https://github.com/P2-718na/gameboy-emulator/actions/workflows/run-tests.yml/badge.svg" alt="" style="pointer-events: none;" class="inline"/></p>
<p>This is an implementation of the original Game Boy (DMG0) hardware written in C++. It features a full CPU implementation and an approximate PPU implementation (no audio, yet). This project can be run standalone (using the provided SFML-based graphical interface) or it can be incorporated in another project as a library. Here are some screenshots!</p>
<p>| <img src="assets/markdown/red.png" alt="" class="inline"/> | <img src="assets/markdown/tetris.png" alt="" class="inline"/> | <img src="assets/markdown/kirby.png" alt="" class="inline"/> | <img src="assets/markdown/world.png" alt="" class="inline"/> | |:---------------------------------&mdash;:|:------------------------------------&mdash;:|:----------------------------------&mdash;:|:----------------------------------&mdash;:|</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Features and Overview</h1>
<p>The goal of this project was not to achieve perfect accuracy, but rather to obtain a functioning implementation that can be easily improved upon. I have approximated some aspects of the hardware and in some places I have valued code clarity above raw performance. I expect most (supported) ROMs to run fine in this emulator, possibly with some graphical glitches. Here is a brief list of all the supported features. To understand the meaning of technical terms, please refer to <a class="el" href="md_HARDWARE.html">HARDWARE.md</a>.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Feature   </th><th class="markdownTableHeadCenter">Status   </th><th class="markdownTableHeadNone">Comment    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU Instructions   </td><td class="markdownTableBodyCenter">游릭   </td><td class="markdownTableBodyNone">All CPU instructions have been implemented and they pass Blargg's <code>cpu_instrs</code> tests (see Testing).    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Interrupts and timers   </td><td class="markdownTableBodyCenter">游릭   </td><td class="markdownTableBodyNone">CPU interrupts and timer have been implemented. Interrupts do pass Blargg's tests; tcu do not (see Testing).    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Savegames   </td><td class="markdownTableBodyCenter">游릭   </td><td class="markdownTableBodyNone">Although very basic, the implementation of savegames (battery-backed cartridges) works correctly. Games are saved whenever the emulator window is closed.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Performance   </td><td class="markdownTableBodyCenter">游릭   </td><td class="markdownTableBodyNone">The DMG hardware is very simple and the emulator runs fast. Multithreading could be implemented easily to speed up performance even more. Profiler shows that the performance impact is uniformly spread out throughout the different Game Boy components.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Graphics   </td><td class="markdownTableBodyCenter">游   </td><td class="markdownTableBodyNone">PPU Timings are machine-cycle accurate, but there is no FIFO implementation. Each scanline gets drawn all at once. Expect some minor glitches.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Timing accuracy   </td><td class="markdownTableBodyCenter">游   </td><td class="markdownTableBodyNone">The time step of the emulator is one machine-cycle. CPU instructions are atomic but execution is still delayed by the correct amount of cycles.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ROM Loading   </td><td class="markdownTableBodyCenter">游   </td><td class="markdownTableBodyNone">Only <code>MBC0</code>, <code>MBC1</code> and <code>MBC3</code> (without RTC hardware) cartridges are implemented. The code is set up to allow for easy addition of new cartridge types. Multicart ROMs are not supported!    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Serial   </td><td class="markdownTableBodyCenter">游   </td><td class="markdownTableBodyNone">Only basic serial reading was implemented for debugging purposes.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Audio   </td><td class="markdownTableBodyCenter">游댮   </td><td class="markdownTableBodyNone">No APU implementation yet.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Hardware bugs and edge cases   </td><td class="markdownTableBodyCenter">游댮   </td><td class="markdownTableBodyNone">Most of the original hardware's edge cases and bugs have not been implemented. Regardless, official ROMs should not depend on them in the first place.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Savestates   </td><td class="markdownTableBodyCenter">游댮   </td><td class="markdownTableBodyNone">The way the code is set up makes serializing the state a bit cumbersome. Regardless, I did not intend for savestates to be available in the first place.   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md4"></a>
Building</h1>
<h2><a class="anchor" id="autotoc_md5"></a>
Dependencies</h2>
<p>The emulator library does not use any external dependencies, apart from the standard library. To build the standalone program, however, you will need:</p><ul>
<li><a href="https://github.com/bfgroup/Lyra">Lyra</a> (already bundled)</li>
<li><a href="https://github.com/onqtam/doctest">Doctest</a> (already bundled)</li>
<li><a href="http://www.sfml-dev.org/">SFML 2.6</a> (has to be installed manually)</li>
</ul>
<p>The recommended way to build this code is by using <a href="https://cmake.org/">CMake</a>. When testing and when writing new code, one should compile using the <code>Debug</code> configuration, as it enables additional checks (<code>-fsanitize="address"</code>, code asserts, ...), disables optimization and writes debugging symbols to the binary file. For the best performance, build using the <code>Release</code> configuration. Bear in mind that code asserts are <em>disabled</em> in the latter, and they should not be relied upon to handle control flow.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Building the standalone emulator</h2>
<div class="fragment"><div class="line"># Clone the repo</div>
<div class="line">git clone git@github.com:P2-718na/gameboy-emulator.git</div>
<div class="line"> </div>
<div class="line"># Create and cd to build directory</div>
<div class="line">take gameboy-emulator/build</div>
<div class="line"> </div>
<div class="line"># Prepare build files. Use &quot;Debug&quot; instead of &quot;Release&quot; to build in debug mode.</div>
<div class="line">cmake .. -DCMAKE_BUILD_TYPE=Release</div>
<div class="line"> </div>
<div class="line"># Build everything</div>
<div class="line">make</div>
</div><!-- fragment --><p>This will configure all the needed files. Two executables will be generated (see Running for additional information on what they do).</p>
<div class="fragment"><div class="line">./emulator   # Run standalone emulator</div>
<div class="line"> </div>
<div class="line">./test      # Run tests</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md7"></a>
Building the emulator library</h2>
<p>All the emulator code is contained in the <code>Gameboy</code> class and its dependencies. To use this in your own CMake project, make sure to 1) add it as a source directory, 2) link it to your target and 3) add all the necessary include folders. </p><div class="fragment"><div class="line"># ...</div>
<div class="line"> </div>
<div class="line">ADD_SUBDIRECTORY(src)</div>
<div class="line"> </div>
<div class="line"># ...</div>
<div class="line"> </div>
<div class="line">TARGET_LINK_LIBRARIES(your_target Gameboy)</div>
<div class="line"> </div>
<div class="line"># ...</div>
<div class="line"> </div>
<div class="line">INCLUDE_DIRECTORIES(</div>
<div class="line">        &quot;${PROJECT_SOURCE_DIR}/src&quot;</div>
<div class="line">        &quot;${PROJECT_SOURCE_DIR}/src/Frontend&quot;</div>
<div class="line">        &quot;${PROJECT_SOURCE_DIR}/src/Gameboy&quot;</div>
<div class="line">        &quot;${PROJECT_SOURCE_DIR}/src/CPU&quot;</div>
<div class="line">        &quot;${PROJECT_SOURCE_DIR}/src/PPU&quot;</div>
<div class="line">        &quot;${PROJECT_SOURCE_DIR}/src/TimerController&quot;</div>
<div class="line">        &quot;${PROJECT_SOURCE_DIR}/src/AddressBus&quot;</div>
<div class="line">        &quot;${PROJECT_SOURCE_DIR}/src/Cartridge&quot;</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"># ...</div>
</div><!-- fragment --><p> The current organization of the include directories is a bit cumbersome, but I am planning on improving it. If you want to run Blargg's tests, make sure to also copy the test ROMs to the binary folder.</p>
<p>To learn how to use the <code>Gameboy</code> library, please refer to the documentation.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Building on different systems</h2>
<p>The code was written on macOS Monterey (Apple clang 14.0.0) and it builds just fine on Linux. Building on Windows and other systems should be just a matter of installing SFML and running CMake.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Running</h1>
<h2><a class="anchor" id="autotoc_md10"></a>
Standalone emulator</h2>
<p>The standalone emulator should be called with exactly one parameter: the path to the ROM file to be loaded </p><div class="fragment"><div class="line">./emulator rom-name.gb</div>
</div><!-- fragment --><p> if the ROM file is of a battery-backed cartridge, a save file will be generated (if not already present) in the same folder as the ROM, named <code>rom-name.gb.sav</code>. The save file will then be loaded automatically every time the game is run. Please bear in mind that the ROM and the save file should be kept in the same folder and should respect the naming convention that was just described here, in order to be loaded correctly.</p>
<p>Running the emulator will open a window. Then, the user can interact with the emulator using the following key bindings.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Key   </th><th class="markdownTableHeadCenter">Game Boy button    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Space   </td><td class="markdownTableBodyCenter">A    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Shift   </td><td class="markdownTableBodyCenter">B    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Enter   </td><td class="markdownTableBodyCenter">Start    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Escape   </td><td class="markdownTableBodyCenter">Select    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">W/A/S/D   </td><td class="markdownTableBodyCenter">&uarr;/&larr;/&darr;/&rarr;   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md11"></a>
Tests</h2>
<p>Here I am using the <a href="https://github.com/doctest/doctest">Doctest</a> library to run tests. Currently, the tests consist of a subset of <a href="https://gbdev.gg8.se/wiki/articles/Test_ROMs">Blargg's test ROMs</a> and a series of unit tests written by me. Not all methods are tested, but asserts are added throughout the entire code base to check for possible mistakes in the development phase.</p>
<p>To launch the tests, run </p><div class="fragment"><div class="line">./test</div>
</div><!-- fragment --><p> from the build directory. This will run both unit tests and the test ROMs, in order. Please bear in mind that not all test ROMs will complete successfully: this is due to the emulator approximations, and it is expected. Only the failure of critical test ROMs (such as <code>cpu_instrs</code>) will report the tests as unsuccessful.</p>
<h1><a class="anchor" id="autotoc_md12"></a>
Code structure</h1>
<p>The code follows the basic principles of Object-Oriented Programming. Each physical Game Boy component is implemented in its own separate class (<code>CPU</code>, <code>PPU</code>, <code>TimerController</code>). Each component has a <code>machineClock()</code> method (to be called each clock cycle) and has access to the shared <code>AddressBus</code> and to the main <code>Gameboy</code> instance. The <code>Cartridge</code> class is an interface used to implement different cartridge types. Finally, the <code>Frontend</code> class handles the interactions with the user and the environment. The <code>Gameboy</code> class is to be intended as the public interface of the library, and additional documentation is available for it (see Documentation). The following table contains a summary of what each class does.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Class   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>Frontend</code>   </td><td class="markdownTableBodyNone">Handles loading of ROMs and save files, graphical output, user input, and clocks the emulator.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>Gameboy</code>   </td><td class="markdownTableBodyNone">Container for all the Game Boy components. Handles interrupt requests and exposes methods that allow <code>Frontend</code> to read and change the status of the system (display, inputs...).    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>AddressBus</code>   </td><td class="markdownTableBodyNone">Handles reads and writes from RAM, ROM and registers. All components of the Game Boy should have access to this.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>Cartridge</code>   </td><td class="markdownTableBodyNone">Virtual base class that defines the interface that each cartridge type should have. Implementations of new cartridge hardware should be added as a derived class of this one.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>CPU</code>   </td><td class="markdownTableBodyNone">Represents the physical Game Boy processor. Reads and executes instructions from the Address Bus.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>PPU</code>   </td><td class="markdownTableBodyNone">Represent the physical Game Boy graphics unit. Periodically updates the screen buffer and requests the necessary interrupts.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>TimerController</code>   </td><td class="markdownTableBodyNone">Represent the physical Game Boy timer hardware. Consists of a series of counters that increment at each clock cycle and eventually request interrupts.   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md13"></a>
Additional notes</h1>
<h2><a class="anchor" id="autotoc_md14"></a>
Contributing</h2>
<p>If you want to open a pull request, please see <a class="el" href="md_CONTRIBUTING.html">CONTRIBUTING.md</a></p>
<h2><a class="anchor" id="autotoc_md15"></a>
Hardware primer</h2>
<p>For a quick introduction to the DMG0's hardware, and the list of all the references I used for this project, see <a class="el" href="md_HARDWARE.html">HARDWARE.md</a></p>
<h2><a class="anchor" id="autotoc_md16"></a>
Documentation</h2>
<p>Documentation is automatically generated for the <code>Gameboy</code> library using Doxygen. The documentation for the current version on <code>master</code> is available <a href="https://p2-718na.github.io/gameboy-emulator/html/classgb_1_1Gameboy.html">here</a>.</p>
<h2><a class="anchor" id="autotoc_md17"></a>
On code clarity</h2>
<p>I used several tools to make sure that my code is correct, clean and consistent. Namely:</p>
<ol type="1">
<li>Clang-Format to check code formatting (<a href=".clang-format">.clang-format</a>).</li>
<li>Clang-Tidy to check for common bad-practice warnings (<a href="https://confluence.jetbrains.com/display/CLION/Clang-Tidy+in+CLion%3A+default+configuration?_ga=2.184137826.59717557.1623227743-1021145942.1623227743">CLion default configuration</a>).</li>
</ol>
<p>I also run the code through <em>Valgrind Memcheck</em> so to make sure that there are no memory-related errors in my code.</p>
<hr  />
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
